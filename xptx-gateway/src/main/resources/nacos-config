spring:
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
      discovery:
      # 是否与服务发现组件进行结合，通过 serviceId 转发到具体的服务实例。默认为false，设为true便开启通过服务中心的自动根据 serviceId 创建路由的功能。
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        #        基础服务
        - id: prex-system-base-server
          # lb代表从注册中心获取服务，且已负载均衡方式转发
          uri: lb://prex-system-base-server
          predicates: # 路由条件，Predicate 接受一个输入参数，返回一个布尔值结果
            - Path=/sys/**
          filters:
            - SwaggerHeaderFilter
            - StripPrefix=1
            # 降级配置
            - name: Hystrix
              args:
                name: fallback
                fallbackUri: forward:/fallback
        #        授权服务
        - id: prex-auth
          uri: lb://prex-auth
          predicates:
            - Path=/auth/**
          filters:
            - ImageCodeFilter
            - RemoveRequestHeader=Origin
            - StripPrefix=1
            # 降级配置
            - name: Hystrix
              args:
                name: fallbackcmd
                fallbackUri: forward:/fallback
        #        监控服务
        - id: prex-monitor
          uri: lb://prex-monitor
          predicates:
            - Path=/monitor/**
          filters:
            - SwaggerHeaderFilter
            - StripPrefix=1
        #      #clientA
        - id: client
          uri: lb://prex-client
          predicates:
            - Path=/prex-client/**
          filters:
            - SwaggerHeaderFilter
            - StripPrefix=1
            #filter名称必须是RequestRateLimiter
            - name: RequestRateLimiter
              args:
                #使用SpEL按名称引用bean
                key-resolver: "#{@remoteAddrKeyResolver}"
                #允许用户每秒处理多少个请求
                redis-rate-limiter.replenishRate: 1
                #令牌桶的容量，允许在一秒钟内完成的最大请求数
                redis-rate-limiter.burstCapacity: 5
  redis:
    database: 1
    host: 101.132.64.80
    jedis:
      pool:
        max-active: 8
        max-idle: 8
        max-wait: 30000ms
        min-idle: 1
    password: Aa123456
    port: 6379
    timeout: 6000ms
# logging:
#   level:
#     org.springframework.cloud.gateway: debug

# hystrix 信号量隔离，5秒后自动超时
hystrix:
  command:
    default:  #default全局有效，feign id指定应用有效
      execution:
        timeout:
          enabled: true
        isolation:
          strategy: SEMAPHORE
          thread:
            timeoutInMilliseconds: 5000 #断路器超时时间，默认1000ms